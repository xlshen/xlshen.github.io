<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            border: 0;
            outline: 0;
        }
        li{
            list-style-type: none;
        }
        html,body{
            height: 100%;
            font: 14px/20px "Microsoft YaHei";
            box-sizing: border-box;
        }
        .multi-picker{
            height: 100vh;
            display: flex;
            flex-flow: column;
        }
        .picker-selected{
            flex: 0 0 30px;
            display: flex;
        }
        .label-for{
            flex: 0 1 8em;
        }
        .selected .selected-item{
            padding: 0 4px;
        }
        .picker-container{
            flex: 0 1 auto;
            display: flex;
        }
        .data-level{
            flex: 1;
            display: flex;
        }
        .picker-container .data-level-one{
            flex: 1;
            overflow-y: scroll;
        }
        .picker-container .data-level-two{
            flex: 2;
            overflow-y: scroll;
        }
        .level-one{
            line-height: 2;
        }
        .level-two{
            line-height: 2;
        }
        .level-one span{
            color: #f90
        }
    </style>
</head>
<body>

    <section class="multi-picker">
        <section class="picker-selected">
            <label class="label-for">已选中的城市：</label>
            <section class="selected">
                <span class="selected-item" data-id="1001">北京</span>
                <span class="selected-item" data-id="1002">上海</span>
            </section>
        </section>
        <section class="picker-container">
            <section class="data-level">
                <ul class="data-level-one">
                    <li class="level-one" data-id="1001">北京 <span></span></li>
                    <li class="level-one" data-id="1002">上海 <span></span></li>
                    <li class="level-one" data-id="1003">天津</li>
                    <li class="level-one" data-id="1004">重庆</li>
                    <li class="level-one" data-id="2001">河北 <span></span></li>
                    <li class="level-one">山西</li>
                    <li class="level-one">内蒙古</li>
                    <li class="level-one">辽宁</li>
                    <li class="level-one">吉林</li>
                    <li class="level-one">黑龙江</li>
                    <li class="level-one">江苏</li>
                    <li class="level-one">浙江</li>
                    <li class="level-one">安徽</li>
                    <li class="level-one">江西</li>
                    <li class="level-one">福建</li>
                    <li class="level-one">山东</li>
                    <li class="level-one">河南</li>
                    <li class="level-one">湖北</li>
                    <li class="level-one">湖南</li>
                    <li class="level-one">广东</li>
                    <li class="level-one">广西</li>
                    <li class="level-one">贵州</li>
                    <li class="level-one">宁夏</li>
                    <li class="level-one">新疆</li>
                    <li class="level-one">青海</li>
                </ul>
                <ul class="data-level-two">
                    <li class="level-two" data-id="2001001">2001001</li>
                    <li class="level-two" data-id="2001002">2001002</li>
                    <li class="level-two" data-id="2001003">2001003</li>
                    <li class="level-two" data-id="2001004">2001004</li>
                    <li class="level-two" data-id="2001005">2001005</li>
                    <li class="level-two" data-id="2001006">2001006</li>
                    <li class="level-two" data-id="2001007">2001007</li>
                    <li class="level-two" data-id="2001008">2001008</li>
                    <li class="level-two" data-id="2001009">2001009</li>
                    <li class="level-two" data-id="2001010">2001010</li>
                </ul>
            </section>
        </section>
    </section>
    <script type="text/javascript">
        /**
         * [City_multi_picker description]
         * @param       {[DOM元素]} element  [组件触发元素]
         * @param       {[Array]} selector_array [默认字面显示内容组成的数组]，如["北京", "上海", "天津"]
         * @param       {[Array]} hidden_value    [隐藏域ID数组]如["1001", "2001", "3001"]
         * @param       {[Object]} context  [description]
         * @constructor
         */
        function City_multi_picker(element, selector_array, hidden_value, context){
            this.element = element;
            this.selector_array = selector_array || [];
            this.hidden_value = hidden_value || [];
            this.context = context || window;
            // 初始化组件
            this.init(this.element, this.selector_array, this.hidden_value, this.context);
        }
        City_multi_picker.prototype = {
            constructor: City_multi_picker,
            /**
             * [description]
             * @param  {[DOM]} selector [description]
             * @param  {[DOM]} context  [description]
             */
            init: function(element, selector_array, hidden_value, context){
                // DOM加载
                // document.body.append(this._init_domTree());
                hidden_value.length === 0 ? "" : this._init_level_one_data(selector_array, hidden_value);
                this._bindEvent();
            },
            /**
             * [description]
             * @param  {[Array]} data [城市数组]
             * @return {[DOM]}      [返回DOM-Tree]
             */
            _init_domTree: function(data){
                // this.level_one_dom_tree 一级数据dom数组
                // this.level_two_dom_tree 二级数据dom数组
                this.level_one_dom_tree = this._init_level_one_tree(data);
                this.level_two_dom_tree = this._init_level_two_tree(data);
                return ;
            },
            /**
             * [一级数据构建]
             * @param  {[Array]} selector_array
             * @param  {[Array]} hidden_value
             */
            _init_level_one_data: function(selector_array, hidden_value){

                var FIRST_LEVEL_ONE_ELEMENT = document.querySelector(".level-one");
                // 直接遍历selector_array
                document.querySelectorAll(".level-one").forEach(function(dom_value, dom_index){
                    hidden_value.sort().forEach(function(value, index){
                        if(dom_value.getAttribute("data-id") === value.slice(0, 4)){
                            dom_value.querySelector("span").textContent = Number(dom_value.querySelector("span").textContent) + 1;
                        };
                    });
                });
                // 第一个元素是否在里面
                if(hidden_value.indexOf(FIRST_LEVEL_ONE_ELEMENT.getAttribute("data-id")) !== -1){
                    // trigger level_one
                }

            },
            _init_level_two_data: function(selector_array, hidden_value){

            },
            _get_selected_data: function(){
                return [].map.call(document.querySelectorAll(".selected-item"), function(value, index){
                            return value.getAttribute("data-id");
                        });
            },
            _bindEvent: function(){
                var _this = this;
                document.body.addEventListener("click", function (event) {
                  if (event.target.classList.contains("level-one")) {
                    var dataId = event.target.getAttribute("data-id");
                    // 获取选中数据
                    // 判断对应的一级菜单有没有数组
                    console.log(_this._get_selected_data())
                  }
                });
            },
            show: function(){

            },
            hide: function(){

            },
            destory: function(){

            }
        }
        new City_multi_picker("", ["北京", "上海"], ["1001", "2001"]);
    </script>
</body>
</html>
